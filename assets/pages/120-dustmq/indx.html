<!DOCTYPE html>
<html lang="ko-KR">
<head>
  <meta charset="UTF-8" />
  <title>GitHub ì¸ì¦ ì‹¤ìŠµ</title>
</head>
<body>
  <h1>ğŸ“¦ ë‚´ GitHub ì €ì¥ì†Œ ëª©ë¡ ë³´ê¸°</h1>
  <form>
      <label for="github-personal-access-token">GitHub ê°œì¸ ì—‘ì„¸ìŠ¤ í† í°</label>
      <input
          type="text" 
          id="github-personal-access-token" 
          placeholder="í† í° ì…ë ¥í•˜ì„¸ìš”"
            size="60"
        />
      <button type="submit">ì €ì¥ì†Œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</button>
  </form>
  <ul data-id="repoList"></ul>

<script>
  // ì—¬ê¸°ì— ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
  {
    const COUNT_PER_PAGE = 3
    const GITHUB_ENDPOINT = 'https://api.github.com/user/repos'
    const repoList = document.querySelector('[data-id="repoList"]')
    const form = document.querySelector('form')

    form.addEventListener('submit', (e) => {
      e.preventDefault()
      const form = e.currentTarget
      const [tokenInput] = form.elements
      const token = tokenInput.value.trim()

      fetchGitHubUserRepos(token)
        .then(renderRepos)
        .catch(renderError)

      form.reset()
    })

    function fetchGitHubUserRepos(token) {
      console.log(token)

      return fetch(`${GITHUB_ENDPOINT}?per_page=${COUNT_PER_PAGE}`, {
        method: 'GET',
        headers: { 'Authorization': `Bearer ${token}` }
      })
        // ì˜¤ë¥˜ ì²˜ë¦¬ (ì§ì ‘)
        .then((response) => 
          response.json()
            .then((data) => {
              // ì´í–‰ëœ ê²½ìš°
              if (response.ok) return data
              // ê±°ì ˆëœ ê²½ìš°
              // 1. return Promise.reject(new Error('error message'))
              return Promise.reject(new Error(data.message))
              // 2. throw new Error('error message')
            })
        )
    }

    // DOM ì—…ë°ì´íŠ¸
    // ì´í–‰ëœ ê²½ìš°
    function renderRepos(data) {
      // ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
      console.log('render repos')
    }
    // ê±°ì ˆëœ ê²½ìš°
    function renderError(error) {
      // ì‚¬ìš©ìì—ê²Œ ì˜¤ë¥˜ ë©”ì‹œì§€ ë Œë”ë§ (ì•ˆë‚´)
      console.log('render error')
    }

  }
</script>
</body>
</html>